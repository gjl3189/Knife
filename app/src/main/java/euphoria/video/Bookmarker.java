package euphoria.video;import android.content.Context;import android.util.Log;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.DataInputStream;import java.io.DataOutputStream;import euphoria.psycho.knife.util.Utils;import euphoria.psycho.knife.video.BlobCache;import euphoria.psycho.knife.video.CacheManager;public class Bookmarker {    private static final String TAG = "Bookmarker";    private static final String BOOKMARK_CACHE_FILE = "video_bookmark";    private static final int BOOKMARK_CACHE_MAX_ENTRIES = 100;    private static final int BOOKMARK_CACHE_MAX_BYTES = 10 * 1024;    private static final int BOOKMARK_CACHE_VERSION = 1;    private static final int HALF_MINUTE = 30 * 1000;    private static final int TWO_MINUTES = 4 * HALF_MINUTE;    private final Context mContext;    public Bookmarker(Context context) {        mContext = context;    }    public void setBookmark(String path, long bookmark/*, int duration*/) {        try {            BlobCache cache = CacheManager.getCache(mContext,                    BOOKMARK_CACHE_FILE, BOOKMARK_CACHE_MAX_ENTRIES,                    BOOKMARK_CACHE_MAX_BYTES, BOOKMARK_CACHE_VERSION);            ByteArrayOutputStream bos = new ByteArrayOutputStream();            DataOutputStream dos = new DataOutputStream(bos);            dos.writeUTF(path);            dos.writeLong(bookmark);            //dos.writeInt(duration);            dos.flush();            cache.insert(Utils.crc64Long(path), bos.toByteArray());        } catch (Throwable t) {            Log.w(TAG, "setBookmark failed", t);        }    }    public Long getBookmark(String path) {        try {            BlobCache cache = CacheManager.getCache(mContext,                    BOOKMARK_CACHE_FILE, BOOKMARK_CACHE_MAX_ENTRIES,                    BOOKMARK_CACHE_MAX_BYTES, BOOKMARK_CACHE_VERSION);            byte[] data = cache.lookup(Utils.crc64Long(path));            if (data == null) return 0L;            DataInputStream dis = new DataInputStream(                    new ByteArrayInputStream(data));            String uriString = DataInputStream.readUTF(dis);            long bookmark = dis.readLong();            //int duration = dis.readInt();            if (!uriString.equals(path)) {                return 0L;            }//            if ((bookmark < HALF_MINUTE) || (duration < TWO_MINUTES)//                    || (bookmark > (duration - HALF_MINUTE))) {//                return null;//            }            return bookmark;        } catch (Throwable t) {            Log.w(TAG, "getBookmark failed", t);        }        return null;    }}